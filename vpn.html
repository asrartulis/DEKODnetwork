document.addEventListener("DOMContentLoaded", function () {
    function getRandomIp() {
        return `192.168.${Math.floor(Math.random() * 255)}.${Math.floor(Math.random() * 255)}`;
    }

    function closeTab() {
        document.body.style.animation = "glitch 0.5s infinite";
        setTimeout(() => window.close(), 3000);
    }

    function showMessage(message, buttons = []) {
        const container = document.getElementById("vpnCheck");
        container.innerHTML = `<p>${message}</p>`;
        buttons.forEach(btn => {
            const button = document.createElement("button");
            button.innerText = btn.text;
            button.onclick = btn.action;
            container.appendChild(button);
        });
    }

    function startVpnCheck() {
        showMessage("Is your VPN on?", [
            { text: "NO", action: () => noVpnFlow() },
            { text: "YES", action: () => yesVpnFlow() }
        ]);
    }

    function noVpnFlow() {
        showMessage(`No wonder... Is this your IP address? ${getRandomIp()} Location: Malaysia`);
        setTimeout(() => {
            showMessage("It's not safe here, do you wish to continue?", [
                { text: "YES, PROCEED", action: () => redirectToHomepage("You've been warned. Have fun.") },
                { text: "NO, TAKE ME BACK", action: () => { 
                    showMessage("Good choice."); 
                    closeTab(); 
                }}
            ]);
        }, 6000);
    }

    function yesVpnFlow() {
        showMessage("Verifying VPN status... <br><progress></progress>");
        setTimeout(() => {
            showMessage(`Are you sure it's working? Isn't this yours? <br>Your IP address: ${getRandomIp()} Location: Malaysia`, [
                { text: "YES, PROCEED", action: () => redirectToHomepage() },
                { text: "NO, LEAVE", action: () => { 
                    showMessage("Good choice."); 
                    closeTab(); 
                }}
            ]);
        }, 3000);
    }

    function redirectToHomepage(message = "") {
        showMessage(message);
        setTimeout(() => {
            window.location.href = "homepage.html";
        }, 3000);
    }

    startVpnCheck();
});
